<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è - –£—Ä–æ–∫ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –±–µ–∑—É–¥–∞—Ä–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .exercise {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .exercise h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .exercise-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .question {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: border-color 0.3s;
        }

        .question:hover {
            border-color: #667eea;
        }

        .question-text {
            margin-bottom: 10px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input.correct {
            border-color: #4CAF50;
            background-color: #e8f5e9;
        }

        input.incorrect {
            border-color: #f44336;
            background-color: #ffebee;
        }

        .radio-group label {
            display: block;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-group label:hover {
            background: #f5f5f5;
            border-color: #667eea;
        }

        .radio-group input[type="radio"] {
            margin-right: 10px;
        }

        .radio-group label.correct {
            background: #e8f5e9;
            border-color: #4CAF50;
        }

        .radio-group label.incorrect {
            background: #ffebee;
            border-color: #f44336;
        }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 150px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .check-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .check-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .reset-btn {
            background: #f44336;
            color: white;
        }

        .reset-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .show-answer-btn {
            background: #4CAF50;
            color: white;
        }

        .show-answer-btn:hover {
            background: #388E3C;
            transform: translateY(-2px);
        }

        .result-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        .result-box.show {
            display: block;
        }

        .result-box h3 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .result-box p {
            font-size: 1.2em;
        }

        .score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }

        .emoji {
            font-size: 3em;
            margin: 10px 0;
        }

        .answer-key {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .answer-key.show {
            display: block;
        }

        .answer-key h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .answer-key-content {
            color: #856404;
            line-height: 1.8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }

        .hint {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            color: #1565c0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">        <div class="user-info" id="userInfo" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
            <span style="font-weight: bold; color: #1976d2;">üë§ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: </span>
            <span id="userEmail" style="color: #666;"></span>
        </div>        <h1>üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</h1>
        <p class="subtitle">–£—Ä–æ–∫ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –±–µ–∑—É–¥–∞—Ä–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ –≤ –∫–æ—Ä–Ω–µ —Å–ª–æ–≤–∞</p>

        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="check-btn" onclick="window.location.href='lesson-01-vowels-checked.html'" style="background: #757575;">
                ‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏
            </button>
            <button class="check-btn" onclick="window.location.href='../../index.html'" style="background: #2196F3;">
                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar">0%</div>
        </div>

        <!-- –ó–∞–¥–∞–Ω–∏–µ 1 -->
        <div class="exercise">
            <h2>–ó–∞–¥–∞–Ω–∏–µ 1: –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –±—É–∫–≤—ã</h2>
            <p class="exercise-description">–ü–æ–¥–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –±—É–∫–≤—ã (–≤–≤–µ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –±—É–∫–≤—É: –∞, –æ, –µ, –∏, —è)</p>
            
            <div id="exercise1"></div>
            
            <div class="button-group">
                <button class="check-btn" onclick="checkExercise1()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="show-answer-btn" onclick="showAnswers1()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
                <button class="reset-btn" onclick="resetExercise1()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
            
            <div class="answer-key" id="answers1">
                <h4>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:</h4>
                <div class="answer-key-content" id="answersContent1"></div>
            </div>
            
            <div class="result-box" id="result1"></div>
        </div>

        <!-- –ó–∞–¥–∞–Ω–∏–µ 2 -->
        <div class="exercise">
            <h2>–ó–∞–¥–∞–Ω–∏–µ 2: –ù–∞–π–¥–∏—Ç–µ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏</h2>
            <p class="exercise-description">–ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Å–ª–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö (–≤–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ —Ü–µ–ª–∏–∫–æ–º)</p>
            
            <div id="exercise2"></div>
            
            <div class="button-group">
                <button class="check-btn" onclick="checkExercise2()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="show-answer-btn" onclick="showAnswers2()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
                <button class="reset-btn" onclick="resetExercise2()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
            
            <div class="answer-key" id="answers2">
                <h4>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏:</h4>
                <div class="answer-key-content" id="answersContent2"></div>
            </div>
            
            <div class="result-box" id="result2"></div>
        </div>

        <!-- –ó–∞–¥–∞–Ω–∏–µ 3 -->
        <div class="exercise">
            <h2>–ó–∞–¥–∞–Ω–∏–µ 3: –†–∞–∑–ª–∏—á–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–≤</h2>
            <p class="exercise-description">–í—Å—Ç–∞–≤—å—Ç–µ –Ω—É–∂–Ω—ã–µ –±—É–∫–≤—ã, —É—á–∏—Ç—ã–≤–∞—è –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–≤ (–≤–≤–µ–¥–∏—Ç–µ –¥–≤–µ –±—É–∫–≤—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∞ –æ)</p>
            
            <div id="exercise3"></div>
            
            <div class="button-group">
                <button class="check-btn" onclick="checkExercise3()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="show-answer-btn" onclick="showAnswers3()">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
                <button class="reset-btn" onclick="resetExercise3()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
            
            <div class="answer-key" id="answers3">
                <h4>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:</h4>
                <div class="answer-key-content" id="answersContent3"></div>
            </div>
            
            <div class="result-box" id="result3"></div>
        </div>

        <!-- –¢–µ—Å—Ç -->
        <div class="exercise">
            <h2>üéØ –ó–∞–¥–∞–Ω–∏–µ 4: –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç</h2>
            <p class="exercise-description">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞</p>
            
            <div id="test"></div>
            
            <div class="button-group">
                <button class="check-btn" onclick="checkTest()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç</button>
                <button class="reset-btn" onclick="resetTest()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
            
            <div class="result-box" id="resultTest"></div>
        </div>
    </div>

    <script type="module">
        import { AuthService } from '../../src/firebase/services/authService.js';
        import { ExerciseService } from '../../src/firebase/services/exerciseService.js';
        import SkillsService from '../../src/firebase/services/skillsService.js';

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
        let taskResults = {
            'exercise1': { correct: 0, total: 10, name: '–ó–∞–¥–∞–Ω–∏–µ 1: –í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –±—É–∫–≤—ã', completed: false },
            'exercise2': { correct: 0, total: 5, name: '–ó–∞–¥–∞–Ω–∏–µ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏', completed: false },
            'exercise3': { correct: 0, total: 5, name: '–ó–∞–¥–∞–Ω–∏–µ 3: –†–∞–∑–ª–∏—á–∏—Ç—å –ø–∞—Ä—ã —Å–ª–æ–≤', completed: false },
            'test': { correct: 0, total: 5, name: '–ó–∞–¥–∞–Ω–∏–µ 4: –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç', completed: false }
        };

        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–¥–∞–Ω–∏–π
        const exercise1Data = [
            { word: '–¥..—Ä–µ–≤—å—è', answer: '–µ', check: '–¥–µ—Ä–µ–≤–æ' },
            { word: '–≥—Ä..–∑–∞', answer: '–æ', check: '–≥—Ä–æ–∑—ã' },
            { word: '–≤..—Å–Ω–∞', answer: '–µ', check: '–≤—ë—Å–Ω—ã' },
            { word: '—Ç..–º–Ω–µ—Ç—å', answer: '–µ', check: '—Ç—ë–º–Ω—ã–π' },
            { word: '–ø..—Ç—ë—Ä–∫–∞', answer: '—è', check: '–ø—è—Ç—å' },
            { word: '—Ö–≤..–ª–∏—Ç—å', answer: '–∞', check: '—Ö–≤–∞–ª–∏—Ç' },
            { word: '—Å–∫—Ä..–ø—É—á–∏–π', answer: '–∏', check: '—Å–∫—Ä–∏–ø' },
            { word: '–∑–≤..–Ω–∏—Ç—å', answer: '–æ', check: '–∑–≤–æ–Ω' },
            { word: '—Ç—Ä..–ø–∏–Ω–∫–∞', answer: '–æ', check: '—Ç—Ä–æ–ø—ã' },
            { word: '–ª..–ø–∏—Ç—å', answer: '–µ', check: '–ª–µ–ø–∏—Ç' }
        ];

        const exercise2Data = [
            { sentence: '–í–∏—Å–µ–Ω–Ω–∏–π –¥–æ–∂–¥—å', wrong: '–í–∏—Å–µ–Ω–Ω–∏–π', correct: '–í–µ—Å–µ–Ω–Ω–∏–π', check: '–≤—ë—Å–Ω—ã' },
            { sentence: '–ü—Ä–∏–º–∏—Ä—è—Ç—å –¥—Ä—É–∑–µ–π', wrong: '–ü—Ä–∏–º–∏—Ä—è—Ç—å', correct: '–ü—Ä–∏–º–∏—Ä—è—Ç—å', check: '–º–∏—Ä' },
            { sentence: '–ü–æ—Å–≤–µ—Ç–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫–æ–º', wrong: '–ü–æ—Å–≤–µ—Ç–∏—Ç—å', correct: '–ü–æ—Å–≤–µ—Ç–∏—Ç—å', check: '—Å–≤–µ—Ç' },
            { sentence: '–ü–æ–ª–µ—Å–∫–∞—Ç—å –±–µ–ª—å—ë', wrong: '–ü–æ–ª–µ—Å–∫–∞—Ç—å', correct: '–ü–æ–ª–æ—Å–∫–∞—Ç—å', check: '–ø–æ–ª–æ—â–µ—Ç' },
            { sentence: '–†–∞–∑—Ä–µ–¥–∏—Ç—å –æ–±—Å—Ç–∞–Ω–æ–≤–∫—É', wrong: '–†–∞–∑—Ä–µ–¥–∏—Ç—å', correct: '–†–∞–∑—Ä—è–¥–∏—Ç—å', check: '—Ä–∞–∑—Ä—è–¥–∫–∞' }
        ];

        const exercise3Data = [
            { pair: '–ü–æ–ª..—Å–∫–∞—Ç—å –∫–æ—Ç—ë–Ω–∫–∞ / –ü–æ–ª..—Å–∫–∞—Ç—å –±–µ–ª—å—ë', answer: '–∞ –æ', check: '–ª–∞—Å–∫–∞ / –ø–æ–ª–æ—â–µ—Ç' },
            { pair: '–ü–æ—Å–≤..—Ç–∏—Ç—å —Å—Ç–∏—Ö–∏ / –ü–æ—Å–≤..—Ç–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫–æ–º', answer: '—è –µ', check: '—Å–≤—è—Ç–æ—Å—Ç—å / —Å–≤–µ—Ç' },
            { pair: '–ü—Ä–∏–º..—Ä—è—Ç—å –ø–ª–∞—Ç—å–µ / –ü—Ä–∏–º..—Ä—è—Ç—å –¥—Ä—É–∑–µ–π', answer: '–µ –∏', check: '–º–µ—Ä–∫–∞ / –º–∏—Ä' },
            { pair: '–°–ª..–∑–∞—Ç—å —Å –¥–µ—Ä–µ–≤–∞ / –°–ª..–∑–∞—Ç—å —Å–º–µ—Ç–∞–Ω—É', answer: '–µ –∏', check: '–ª–µ–∑—Ç—å / –ª–∏–∂–µ—Ç' },
            { pair: '–£–≤..–¥–∞—Ç—å –∏–∑–¥–∞–ª–µ–∫–∞ / –£–≤..–¥–∞—Ç—å –±–µ–∑ –≤–æ–¥—ã', answer: '–∏ —è', check: '–≤–∏–¥–∏—Ç / –≤—è–ª—ã–π' }
        ];

        const testData = [
            {
                question: '–ö–∞–∫—É—é –≥–ª–∞—Å–Ω—É—é –Ω—É–∂–Ω–æ –≤–ø–∏—Å–∞—Ç—å: –ª..—Å–Ω–æ–π?',
                options: ['–ò', '–ï', '–Ø'],
                correct: 1,
                explanation: '–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ: –ª–µ—Å'
            },
            {
                question: '–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ –¥–ª—è ¬´–≥..—Ä–∞¬ª:',
                options: ['–≥–æ—Ä—ãÃÅ', '–≥–æÃÅ—Ä–Ω—ã–π', '–≥–æ—Ä–µ–≤–∞ÃÅ—Ç—å'],
                correct: 1,
                explanation: '–í –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –ê –∏ –í –≥–ª–∞—Å–Ω–∞—è –±–µ–∑—É–¥–∞—Ä–Ω–∞—è'
            },
            {
                question: '–í –∫–∞–∫–æ–º —Å–ª–æ–≤–µ –ø–∏—à–µ—Ç—Å—è –û?',
                options: ['–≥—Ä..—á–∏ÃÅ', '–º..—Ä—èÃÅ', '–∑..—Ä—èÃÅ'],
                correct: 1,
                explanation: '–º..—Ä—èÃÅ ‚Üí –º–æÃÅ—Ä–µ (–±—É–∫–≤–∞ –û)'
            },
            {
                question: '–í –∫–∞–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –æ—à–∏–±–∫–∞?',
                options: ['–ù–∞–¥–æ –ø—Ä–∏–º–∏—Ä–∏—Ç—å –¥—Ä—É–∑–µ–π', '–Ø –ª—é–±–ª—é –ø–æ–ª–æ—Å–∫–∞—Ç—å –∫–æ—Ç–∞', '–û–Ω —Å—Ç–∞–ª —Å–ª–∏–∑–∞—Ç—å –≤–∞—Ä–µ–Ω—å–µ'],
                correct: 1,
                explanation: '–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ¬´–ø–æ–ª–∞—Å–∫–∞—Ç—å –∫–æ—Ç–∞¬ª (–ª–∞—Å–∫–∞)'
            },
            {
                question: '–ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ –¥–ª—è ¬´–¥..—Ä–µ–≤–Ω—è¬ª:',
                options: ['–¥–µÃÅ—Ä–µ–≤–æ', '–¥–µ—Ä–µÃÅ–≤—å—è', '–¥—Ä–æ–≤–æ—Å–µÃÅ–∫'],
                correct: 0,
                explanation: '–¥–µÃÅ—Ä–µ–≤–æ - —É–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –ï'
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π
        window.initExercise1 = function() {
            const container = document.getElementById('exercise1');
            container.innerHTML = exercise1Data.map((item, index) => `
                <div class="question">
                    <div class="question-text">${index + 1}. ${item.word}</div>
                    <input type="text" id="ex1_${index}" maxlength="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –±—É–∫–≤—É">
                    <div class="feedback" id="feedback1_${index}"></div>
                </div>
            `).join('');
        }

        window.initExercise2 = function() {
            const container = document.getElementById('exercise2');
            container.innerHTML = exercise2Data.map((item, index) => `
                <div class="question">
                    <div class="question-text">${index + 1}. ${item.sentence}</div>
                    <input type="text" id="ex2_${index}" placeholder="–ò—Å–ø—Ä–∞–≤—å—Ç–µ —Å–ª–æ–≤–æ">
                    <div class="feedback" id="feedback2_${index}"></div>
                </div>
            `).join('');
        }

        window.initExercise3 = function() {
            const container = document.getElementById('exercise3');
            container.innerHTML = exercise3Data.map((item, index) => `
                <div class="question">
                    <div class="question-text">${index + 1}. ${item.pair}</div>
                    <input type="text" id="ex3_${index}" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–≤–µ –±—É–∫–≤—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª">
                    <div class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: ${item.check}</div>
                    <div class="feedback" id="feedback3_${index}"></div>
                </div>
            `).join('');
        }

        window.initTest = function() {
            const container = document.getElementById('test');
            container.innerHTML = testData.map((item, index) => `
                <div class="question">
                    <div class="question-text">${index + 1}. ${item.question}</div>
                    <div class="radio-group" id="test_${index}">
                        ${item.options.map((option, optIndex) => `
                            <label>
                                <input type="radio" name="test_${index}" value="${optIndex}">
                                ${String.fromCharCode(65 + optIndex)}) ${option}
                            </label>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedbackTest_${index}"></div>
                </div>
            `).join('');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π
        window.checkExercise1 = async function() {
            let correct = 0;
            
            exercise1Data.forEach((item, index) => {
                const input = document.getElementById(`ex1_${index}`);
                const feedback = document.getElementById(`feedback1_${index}`);
                const userAnswer = input.value.toLowerCase().trim();
                
                if (userAnswer === item.answer) {
                    input.className = 'correct';
                    feedback.className = 'feedback correct show';
                    feedback.innerHTML = `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ: <strong>${item.check}</strong>`;
                    correct++;
                } else if (userAnswer) {
                    input.className = 'incorrect';
                    feedback.className = 'feedback incorrect show';
                    feedback.textContent = '‚úó –ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
                } else {
                    feedback.className = 'feedback incorrect show';
                    feedback.textContent = '‚úó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç';
                }
            });
            
            taskResults['exercise1'].correct = correct;
            taskResults['exercise1'].completed = true;
            
            await showResult('result1', correct, exercise1Data.length);
            updateProgress();
        }

        window.checkExercise2 = async function() {
            let correct = 0;
            exercise2Data.forEach((item, index) => {
                const input = document.getElementById(`ex2_${index}`);
                const feedback = document.getElementById(`feedback2_${index}`);
                const userAnswer = input.value.trim();
                
                if (userAnswer.toLowerCase() === item.correct.toLowerCase()) {
                    input.className = 'correct';
                    feedback.className = 'feedback correct show';
                    feedback.innerHTML = `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ: <strong>${item.check}</strong>`;
                    correct++;
                } else if (userAnswer) {
                    input.className = 'incorrect';
                    feedback.className = 'feedback incorrect show';
                    feedback.innerHTML = `‚úó –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: <strong>${item.correct}</strong>`;
                } else {
                    feedback.className = 'feedback incorrect show';
                    feedback.textContent = '‚úó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç';
                }
            });
            
            taskResults['exercise2'].correct = correct;
            taskResults['exercise2'].completed = true;
            
            await showResult('result2', correct, exercise2Data.length);
            updateProgress();
        }

        window.checkExercise3 = async function() {
            let correct = 0;
            exercise3Data.forEach((item, index) => {
                const input = document.getElementById(`ex3_${index}`);
                const feedback = document.getElementById(`feedback3_${index}`);
                const userAnswer = input.value.toLowerCase().trim();
                
                if (userAnswer === item.answer) {
                    input.className = 'correct';
                    feedback.className = 'feedback correct show';
                    feedback.innerHTML = `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞: <em>${item.check}</em>`;
                    correct++;
                } else if (userAnswer) {
                    input.className = 'incorrect';
                    feedback.className = 'feedback incorrect show';
                    feedback.innerHTML = `‚úó –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞: <em>${item.check}</em>`;
                } else {
                    feedback.className = 'feedback incorrect show';
                    feedback.textContent = '‚úó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç';
                }
            });
            
            taskResults['exercise3'].correct = correct;
            taskResults['exercise3'].completed = true;
            
            await showResult('result3', correct, exercise3Data.length);
            updateProgress();
        }

        window.checkTest = async function() {
            let correct = 0;
            testData.forEach((item, index) => {
                const radioGroup = document.getElementById(`test_${index}`);
                const feedback = document.getElementById(`feedbackTest_${index}`);
                const selected = radioGroup.querySelector('input:checked');
                
                if (selected) {
                    const userAnswer = parseInt(selected.value);
                    const labels = radioGroup.querySelectorAll('label');
                    
                    if (userAnswer === item.correct) {
                        labels[userAnswer].className = 'correct';
                        feedback.className = 'feedback correct show';
                        feedback.innerHTML = `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! ${item.explanation}`;
                        correct++;
                    } else {
                        labels[userAnswer].className = 'incorrect';
                        labels[item.correct].className = 'correct';
                        feedback.className = 'feedback incorrect show';
                        feedback.innerHTML = `‚úó –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>${String.fromCharCode(65 + item.correct)}</strong>. ${item.explanation}`;
                    }
                } else {
                    feedback.className = 'feedback incorrect show';
                    feedback.textContent = '‚úó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç';
                }
            });
            
            taskResults['test'].correct = correct;
            taskResults['test'].completed = true;
            
            await showResult('resultTest', correct, testData.length);
            updateProgress();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
        window.showAnswers1 = function() {
            const answersDiv = document.getElementById('answers1');
            const content = document.getElementById('answersContent1');
            content.innerHTML = exercise1Data.map((item, index) => 
                `<p>${index + 1}. ${item.word.replace('..', '<strong>' + item.answer + '</strong>')} ‚Äî –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ: <strong>${item.check}</strong></p>`
            ).join('');
            answersDiv.classList.add('show');
        }

        window.showAnswers2 = function() {
            const answersDiv = document.getElementById('answers2');
            const content = document.getElementById('answersContent2');
            content.innerHTML = exercise2Data.map((item, index) => 
                `<p>${index + 1}. ${item.sentence} ‚Üí <strong>${item.correct}</strong> (${item.check})</p>`
            ).join('');
            answersDiv.classList.add('show');
        }

        window.showAnswers3 = function() {
            const answersDiv = document.getElementById('answers3');
            const content = document.getElementById('answersContent3');
            content.innerHTML = exercise3Data.map((item, index) => 
                `<p>${index + 1}. ${item.answer.split(' ').join(' / ')} ‚Äî ${item.check}</p>`
            ).join('');
            answersDiv.classList.add('show');
        }

        // –°–±—Ä–æ—Å –∑–∞–¥–∞–Ω–∏–π
        window.resetExercise1 = function() {
            exercise1Data.forEach((_, index) => {
                document.getElementById(`ex1_${index}`).value = '';
                document.getElementById(`ex1_${index}`).className = '';
                document.getElementById(`feedback1_${index}`).className = 'feedback';
            });
            document.getElementById('result1').classList.remove('show');
            document.getElementById('answers1').classList.remove('show');
            taskResults['exercise1'].correct = 0;
            taskResults['exercise1'].completed = false;
            updateProgress();
        }

        window.resetExercise2 = function() {
            exercise2Data.forEach((_, index) => {
                document.getElementById(`ex2_${index}`).value = '';
                document.getElementById(`ex2_${index}`).className = '';
                document.getElementById(`feedback2_${index}`).className = 'feedback';
            });
            document.getElementById('result2').classList.remove('show');
            document.getElementById('answers2').classList.remove('show');
            taskResults['exercise2'].correct = 0;
            taskResults['exercise2'].completed = false;
            updateProgress();
        }

        window.resetExercise3 = function() {
            exercise3Data.forEach((_, index) => {
                document.getElementById(`ex3_${index}`).value = '';
                document.getElementById(`ex3_${index}`).className = '';
                document.getElementById(`feedback3_${index}`).className = 'feedback';
            });
            document.getElementById('result3').classList.remove('show');
            document.getElementById('answers3').classList.remove('show');
            taskResults['exercise3'].correct = 0;
            taskResults['exercise3'].completed = false;
            updateProgress();
        }

        window.resetTest = function() {
            testData.forEach((_, index) => {
                const radioGroup = document.getElementById(`test_${index}`);
                const radios = radioGroup.querySelectorAll('input');
                const labels = radioGroup.querySelectorAll('label');
                radios.forEach(radio => radio.checked = false);
                labels.forEach(label => label.className = '');
                document.getElementById(`feedbackTest_${index}`).className = 'feedback';
            });
            document.getElementById('resultTest').classList.remove('show');
            taskResults['test'].correct = 0;
            taskResults['test'].completed = false;
            updateProgress();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤
        function notifySkillUpdate(userId, skillId) {
            try {
                const channel = new BroadcastChannel('skills-update');
                channel.postMessage({
                    type: 'SKILL_UPDATED',
                    skillId: skillId,
                    userId: userId,
                    timestamp: Date.now()
                });
                channel.close();
                console.log('üì° –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤:', skillId);
            } catch (e) {
                console.log('BroadcastChannel –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', e);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        async function showResult(resultId, correct, total) {
            const resultDiv = document.getElementById(resultId);
            const percentage = Math.round((correct / total) * 100);
            const emoji = percentage >= 90 ? 'üéâ' : percentage >= 70 ? 'üòä' : percentage >= 50 ? 'ü§î' : 'üòî';
            const message = percentage >= 90 ? '–û—Ç–ª–∏—á–Ω–æ!' : percentage >= 70 ? '–•–æ—Ä–æ—à–æ!' : percentage >= 50 ? '–ù–µ–ø–ª–æ—Ö–æ!' : '–ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å!';
            
            resultDiv.innerHTML = `
                <div class="emoji">${emoji}</div>
                <h3>${message}</h3>
                <div class="score">${correct} –∏–∑ ${total}</div>
                <p>–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${percentage}%</p>
            `;
            resultDiv.classList.add('show');

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ü–∏—é
            const user = AuthService.getCurrentUser();
            if (user) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                const savingIndicator = document.createElement('div');
                savingIndicator.id = `saving-${resultId}`;
                savingIndicator.style.cssText = 'margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 5px; color: #1976d2; font-size: 0.9em;';
                savingIndicator.textContent = 'üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è...';
                resultDiv.appendChild(savingIndicator);

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                try {
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ —Å–æ –≤—Å–µ–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ (–≤–∫–ª—é—á–∞—è —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
                    const taskResultsArray = [
                        {
                            name: taskResults['exercise1'].name,
                            correct: taskResults['exercise1'].correct,
                            total: taskResults['exercise1'].total,
                            completed: taskResults['exercise1'].completed
                        },
                        {
                            name: taskResults['exercise2'].name,
                            correct: taskResults['exercise2'].correct,
                            total: taskResults['exercise2'].total,
                            completed: taskResults['exercise2'].completed
                        },
                        {
                            name: taskResults['exercise3'].name,
                            correct: taskResults['exercise3'].correct,
                            total: taskResults['exercise3'].total,
                            completed: taskResults['exercise3'].completed
                        },
                        {
                            name: taskResults['test'].name,
                            correct: taskResults['test'].correct,
                            total: taskResults['test'].total,
                            completed: taskResults['test'].completed
                        }
                    ];

                    // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º –∑–∞–¥–∞–Ω–∏—è–º
                    let totalCorrect = 0;
                    let totalQuestions = 0;
                    taskResultsArray.forEach(task => {
                        if (task.completed) {
                            totalCorrect += task.correct;
                            totalQuestions += task.total;
                        }
                    });
                    const totalPercentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –∑–∞–¥–∞–Ω–∏—è–º
                    await ExerciseService.saveResult(user.uid, 'exercise-01-vowels-roots', {
                        score: totalPercentage,
                        answers: [],
                        mistakes: [],
                        taskResults: taskResultsArray
                    });

                    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤—ã–∫
                    await SkillsService.updateSkillProgress(
                        user.uid, 
                        'vowels-checked', 
                        correct, 
                        total
                    );

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                    notifySkillUpdate(user.uid, 'vowels-checked');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ü–∏—é –Ω–∞ —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                    savingIndicator.style.background = '#e8f5e9';
                    savingIndicator.style.color = '#2e7d32';
                    savingIndicator.textContent = '‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!';
                    
                    console.log(`‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω: ${correct}/${total}`);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
                    savingIndicator.style.background = '#ffebee';
                    savingIndicator.style.color = '#c62828';
                    savingIndicator.textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
                }
            }

            // –ï—Å–ª–∏ —ç—Ç–æ –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            if (resultId === 'resultTest') {
                if (percentage >= 70) {
                    resultDiv.innerHTML += `
                        <div style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 5px; color: #2e7d32;">
                            ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –ù–∞–≤—ã–∫ –æ–±–Ω–æ–≤–ª—ë–Ω.
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="check-btn" onclick="window.location.href='lesson-01-vowels-checked.html'" style="background: #757575;">
                                ‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏
                            </button>
                            <button class="check-btn" onclick="window.location.href='lesson-02-vowels-unchecked.html'" style="background: #2196F3;">
                                ‚û°Ô∏è –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫
                            </button>
                            <button class="check-btn" onclick="window.location.href='../../index.html'" style="background: #4caf50;">
                                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
                            </button>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML += `
                        <div style="margin-top: 15px; padding: 10px; background: #fff3e0; border-radius: 5px; color: #e65100;">
                            ‚ö†Ô∏è –î–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –º–∏–Ω–∏–º—É–º 70%
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="check-btn" onclick="resetTest()" style="background: #ff9800;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                            <button class="check-btn" onclick="window.location.href='lesson-01-vowels-checked.html'" style="background: #757575;">
                                ‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏
                            </button>
                            <button class="check-btn" onclick="window.location.href='../../index.html'" style="background: #4caf50;">
                                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
                            </button>
                        </div>
                    `;
                }
            }
        }

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ–π
        window.showResult = showResult;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        window.updateProgress = function() {
            const totalQuestions = exercise1Data.length + exercise2Data.length + exercise3Data.length + testData.length;
            let answeredQuestions = 0;

            // –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
            exercise1Data.forEach((_, index) => {
                if (document.getElementById(`ex1_${index}`).value.trim()) answeredQuestions++;
            });
            exercise2Data.forEach((_, index) => {
                if (document.getElementById(`ex2_${index}`).value.trim()) answeredQuestions++;
            });
            exercise3Data.forEach((_, index) => {
                if (document.getElementById(`ex3_${index}`).value.trim()) answeredQuestions++;
            });
            testData.forEach((_, index) => {
                if (document.querySelector(`input[name="test_${index}"]:checked`)) answeredQuestions++;
            });

            const percentage = Math.round((answeredQuestions / totalQuestions) * 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initExercise1();
                initExercise2();
                initExercise3();
                initTest();
                updateProgress();
            });
        } else {
            // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
            initExercise1();
            initExercise2();
            initExercise3();
            initTest();
            updateProgress();
        }
    </script>

    <script type="module">
        import { AuthService } from '../../src/firebase/services/authService.js';
        import SkillsService from '../../src/firebase/services/skillsService.js';
        import { ExerciseService } from '../../src/firebase/services/exerciseService.js';
        import { ProgressService } from '../../src/firebase/services/progressService.js';

        let currentUser = null;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        AuthService.onAuthChange((user) => {
            currentUser = user;
            if (user) {
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('userEmail').textContent = user.email;
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', user.email);
            } else {
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
            }
        });

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Firebase
        async function saveResultsToFirebase() {
            if (!currentUser) {
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                return;
            }

            try {
                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                let totalQuestions = 0;
                let correctAnswers = 0;

                // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 1
                const ex1Results = window.lastExercise1Results || { correct: 0, total: 0 };
                totalQuestions += ex1Results.total;
                correctAnswers += ex1Results.correct;

                // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 2
                const ex2Results = window.lastExercise2Results || { correct: 0, total: 0 };
                totalQuestions += ex2Results.total;
                correctAnswers += ex2Results.correct;

                // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 3
                const ex3Results = window.lastExercise3Results || { correct: 0, total: 0 };
                totalQuestions += ex3Results.total;
                correctAnswers += ex3Results.correct;

                // –¢–µ—Å—Ç
                const testResults = window.lastTestResults || { correct: 0, total: 0 };
                totalQuestions += testResults.total;
                correctAnswers += testResults.correct;

                if (totalQuestions === 0) {
                    console.log('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                    return;
                }

                const score = Math.round((correctAnswers / totalQuestions) * 100);

                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', {
                    correct: correctAnswers,
                    total: totalQuestions,
                    score: score
                });

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                const exerciseResult = await ExerciseService.saveResult(
                    currentUser.uid,
                    'exercise-01-vowels-roots',
                    {
                        score: score,
                        correctAnswers: correctAnswers,
                        totalQuestions: totalQuestions,
                        details: {
                            exercise1: ex1Results,
                            exercise2: ex2Results,
                            exercise3: ex3Results,
                            test: testResults
                        }
                    }
                );

                if (exerciseResult.success) {
                    console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:', exerciseResult.error);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–∫–∞
                const progressResult = await ProgressService.saveProgress(
                    currentUser.uid,
                    'lesson-01-vowels-checked',
                    {
                        completed: score >= 80,
                        score: score,
                        exerciseCompleted: true
                    }
                );

                if (progressResult.success) {
                    console.log('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–∫–∞ –æ–±–Ω–æ–≤–ª—ë–Ω');
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', progressResult.error);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤—ã–∫
                const skillResult = await SkillsService.updateSkillProgress(
                    currentUser.uid,
                    'vowels-checked',
                    correctAnswers,
                    totalQuestions
                );

                if (skillResult.success) {
                    console.log('‚úÖ –ù–∞–≤—ã–∫ –æ–±–Ω–æ–≤–ª—ë–Ω:', skillResult.data);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #4caf50;
                        color: white;
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                        z-index: 10000;
                        animation: slideIn 0.3s ease;
                    `;
                    notification.innerHTML = `
                        <strong>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</strong><br>
                        <span style="font-size: 0.9em;">–ë–∞–ª–ª: ${score}% | –£—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞: ${skillResult.data.level}</span>
                    `;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transition = 'opacity 0.3s';
                        setTimeout(() => notification.remove(), 300);
                    }, 4000);
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–≤—ã–∫–∞:', skillResult.error);
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
            }
        }

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é checkTest –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const originalCheckTest = window.checkTest;
        window.checkTest = function() {
            const result = originalCheckTest();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞
            const testData = window.testData || [];
            let correct = 0;
            testData.forEach((question, index) => {
                const selected = document.querySelector(`input[name="test_${index}"]:checked`);
                if (selected && parseInt(selected.value) === question.correct) {
                    correct++;
                }
            });
            
            window.lastTestResults = {
                correct: correct,
                total: testData.length
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
            setTimeout(() => saveResultsToFirebase(), 500);
            
            return result;
        };

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        const originalCheckEx1 = window.checkExercise1;
        window.checkExercise1 = function() {
            const result = originalCheckEx1();
            
            const data = window.exercise1Data || [];
            let correct = 0;
            data.forEach((item, index) => {
                const input = document.getElementById(`ex1_${index}`);
                if (input && input.value.trim().toLowerCase() === item.answer.toLowerCase()) {
                    correct++;
                }
            });
            
            window.lastExercise1Results = {
                correct: correct,
                total: data.length
            };
            
            return result;
        };

        const originalCheckEx2 = window.checkExercise2;
        window.checkExercise2 = function() {
            const result = originalCheckEx2();
            
            const data = window.exercise2Data || [];
            let correct = 0;
            data.forEach((item, index) => {
                const input = document.getElementById(`ex2_${index}`);
                if (input && input.value.trim().toLowerCase() === item.correct.toLowerCase()) {
                    correct++;
                }
            });
            
            window.lastExercise2Results = {
                correct: correct,
                total: data.length
            };
            
            return result;
        };

        const originalCheckEx3 = window.checkExercise3;
        window.checkExercise3 = function() {
            const result = originalCheckEx3();
            
            const data = window.exercise3Data || [];
            let correct = 0;
            data.forEach((item, index) => {
                const input = document.getElementById(`ex3_${index}`);
                if (input && input.value.trim() !== '') {
                    const words = input.value.split(',').map(w => w.trim().toLowerCase());
                    const correctWords = [item.word1.toLowerCase(), item.word2.toLowerCase()];
                    if (words.every(w => correctWords.includes(w)) && words.length === 2) {
                        correct++;
                    }
                }
            });
            
            window.lastExercise3Results = {
                correct: correct,
                total: data.length
            };
            
            return result;
        };

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.saveResultsToFirebase = saveResultsToFirebase;
        window.currentUser = () => currentUser;
    </script>
</body>
</html>
